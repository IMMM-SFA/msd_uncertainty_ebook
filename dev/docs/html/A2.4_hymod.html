
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>HYMOD Dynamics Tutorial &#8212; Addressing Uncertainty in MultiSector Dynamics Research  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=0a66277c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'A2.4_hymod';</script>
    <script src="_static/custom.js?v=d380ae45"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9WMRS23CZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z9WMRS23CZ');
</script>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Addressing Uncertainty in MultiSector Dynamics Research  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Suggested Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_diagnostic_modeling_overview_and_perspectives.html">2. Diagnostic Modeling Overview and Perspectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_sensitivity_analysis_the_basics.html">3. Sensitivity Analysis: The Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_sensitivity_analysis_diagnostic_and_exploratory_modeling.html">4. Sensitivity Analysis: Diagnostic &amp; Exploratory Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_conclusion.html">5. Conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="A1_Uncertainty_Quantification.html">A. Uncertainty Quantification</a></li>
<li class="toctree-l1"><a class="reference internal" href="A2_Jupyter_Notebooks.html">B. Jupyter Notebook Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="A3_plotting_code.html">C. Plotting Code Samples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="6_glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R.Bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/IMMM-SFA/msd_uncertainty_ebook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/IMMM-SFA/msd_uncertainty_ebook/issues/new?title=Issue%20on%20page%20%2FA2.4_hymod.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/A2.4_hymod.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>HYMOD Dynamics Tutorial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-sensitivity-analysis-of-the-hymod-model">Tutorial: Sensitivity Analysis of the HYMOD Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-hymod">1. Introduction to HYMOD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-sensitivity-analysis">2. Global Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1 - Introduction to HYMOD</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2- Global Sensitivity Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-hymod-model-warm-up">Running HYMOD - Model Warm-up</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis-indices-for-each-month">2.4.1 Sensitivity analysis indices for each month</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-indices">First-order Indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-order-indices">Total-order indices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-sensitivity-analysis-indices">2.4.2 Annual sensitivity analysis indices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">First-order indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Total-order indices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#monthly-time-varying-sensitivity-analysis">2.4.3 Monthly time-varying sensitivity analysis</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">First-order indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-order-time-varying-sensitivity-analysis">Total order - time varying sensitivity analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tips-to-apply-this-methodology-to-your-own-problem">Tips to Apply this methodology to your own problem</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="hymod-dynamics-tutorial">
<h1>HYMOD Dynamics Tutorial<a class="headerlink" href="#hymod-dynamics-tutorial" title="Link to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">Run the tutorial interactively:  <a class="reference external" href="https://uc-ebook-dev.msdlive.org/user-redirect/lab/tree/notebooks/hymod.ipynb">HYMOD Notebook</a>.</div>
<div class="line">Please be aware that notebooks can take a couple minutes to launch.</div>
<div class="line">To run the notebooks yourself, download the files <a class="reference external" href="https://github.com/IMMM-SFA/msd_uncertainty_ebook/tree/main/notebooks">here</a> and use these <a class="reference external" href="https://github.com/IMMM-SFA/msd_uncertainty_ebook/blob/main/pyproject.toml">requirements</a>.</div>
</div>
</div>
<section id="tutorial-sensitivity-analysis-of-the-hymod-model">
<h2>Tutorial: Sensitivity Analysis of the HYMOD Model<a class="headerlink" href="#tutorial-sensitivity-analysis-of-the-hymod-model" title="Link to this heading">#</a></h2>
<p>The purpose of this tutorial is to demonstrate the global sensitivity
analysis concepts and tools established in the Section 3.1 of the main
text of this eBook. This demonstration will highlight the central role
of design of experiments (Section 3.3), when implementing global
sensitivity analysis tools described in Section 3.4.</p>
<p>We’ll explore these tools and concepts using the HYdrological MODel
(HYMOD), a rainfall-runoff model developed and used for river flow
forecasting. HYMOD was chosen for demonstration because its purpose is
to abstract highly complex and non-linear systems. The methods
demonstrated in this tutorial can be applied to numerical models that
simulate other complex non-linear systems.</p>
<p>This tutorial will first introduce HYMOD and use it to simulate
streamflows in a river basin. Next, we’ll employ sensitivity analysis
concepts described in Section 3 of the main text to examine how values
of HYMOD’s parameters impact streamflow predictions. Finally, we’ll
explore how the effects of these parameters may change over time using
time-varying sensitivity analysis.</p>
<p>The tutorial includes the following steps:</p>
<section id="introduction-to-hymod">
<h3>1. Introduction to HYMOD<a class="headerlink" href="#introduction-to-hymod" title="Link to this heading">#</a></h3>
<p>1.1 - Introduction to a simple hydrologic model (HYMOD)</p>
<p>1.2 - Input Data</p>
<p>1.3 - Running a basic simulation</p>
<p>1.4 - Model outputs</p>
</section>
<section id="global-sensitivity-analysis">
<h3>2. Global Sensitivity Analysis<a class="headerlink" href="#global-sensitivity-analysis" title="Link to this heading">#</a></h3>
<p>2.1 - Design of Experiments</p>
<p>2.2 - Sensitivity analysis for one output</p>
<p>2.3 - Sensitivity analysis across multiple outputs</p>
<p>2.4 - Time-varying sensitivity analysis</p>
</section>
</section>
<section id="id1">
<h2>1 - Introduction to HYMOD<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p id="hymod">1.1 Overview</p>
<p>HYMOD is a hydrologic model (rainfall-runoff model) that simulates key
hydrologic fluxes such as infiltration, streamflow and
evapotranspiration. The model was originally developed and used for
river flow forecasting, but it has also been been used to explore
different sensitivity analysis (e.g., <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/wrcr.20124">Herman et al.,
2013</a>),
uncertainty quantification (e.g., <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2006WR005205">Smith et al.,
2008</a>),
and optimization (e.g., <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022169414006362?casa_token=IRqE19Hkfa8AAAAA:_fXOqfwpzxMpchvu8_0njCe0Ok9H29Gyw2F46l9PzG9UVODDTUg6wIOSiyp6uybGevNVnZ7N">Ye et al.,
2014</a>)
concepts.</p>
<p>HYMOD accepts two inputs - daily precipitation and daily potential
evapotranspiration (PET)- and generates predictons of daily streamflow.
HYMOD abstracts the highly non-linear process of runoff routing by
dividing the flow into two components: quick flow, representing
precipitation that quickly runs off the surface of the watershed into
the stream, and slow flow, that moves through the soil and takes much
longer to arrive at the stream.</p>
<p>To generate streamflow predictions, HYMOD first models vertical
processes within the watershed to determine how much water infiltrates
and evaporates from the soil at a given time step. It then determines
how much water should be partitioned into quick flow and slow flow
processes. Within each process it abstracts residence time (the time it
takes a unit volume of water to move through the watershed and into the
stream) using a series of “reservoirs” each with a calibrated residence
time.</p>
<p>HYMOD’s representation of hydrologic processes are shown Figure 1 below
and controlled by the following parameters:</p>
<p><span class="math notranslate nohighlight">\(H_{uz}\)</span>: the maximum water storage capacity of the soil (mm)</p>
<p><span class="math notranslate nohighlight">\(B_{exp}\)</span>: parameters describing the degree of spatial variability
within the basin between 0 and Huz</p>
<p><span class="math notranslate nohighlight">\(Alp\)</span>: Fraction of runoff contributing to quick flow</p>
<p><span class="math notranslate nohighlight">\(K_q\)</span>: Quick flow residence time of linear infinite reservoir (the
Kq values of all three linear reservoirs are the same)</p>
<p><span class="math notranslate nohighlight">\(K_s\)</span>: Slow flow residence time of linear infinite reservoir</p>
<img alt="_images/hymod_schematic-DAVE.png" src="_images/hymod_schematic-DAVE.png" />
<p>HYMOD models the fraction of water that is stored in the soil
<span class="math notranslate nohighlight">\((F(XH_{uz}))\)</span> using the following relationship:</p>
<div class="math notranslate nohighlight">
\[F(XH_{uz}) = 1 - (1 - \frac{XH_{uz}}{H_{uz}})^{B}\]</div>
<p>where <span class="math notranslate nohighlight">\(XH_{uz}\)</span> is the water storage capacity of the soil;
<span class="math notranslate nohighlight">\(H_{uz}\)</span> is the parameter describing basin maximum water
storage capacity (mm); and <span class="math notranslate nohighlight">\(B\)</span> is the parameter describing the
degree of spatial variability within the basin.</p>
<p>The portion of precipitation that exceeds the water storage capacity is
treated as runoff.</p>
<p>To route runoff to streamflow, the excess runoff from the vertical
processes is split into quick flow and slow flow. The proportion of
runoff partitioned into quick flow and slow flow is determined by a
parameter <span class="math notranslate nohighlight">\(Alp\)</span>, which ranges between 0 and 1. Quick flow is
routed through <span class="math notranslate nohighlight">\(N\)</span> identical quick flow tanks <span class="math notranslate nohighlight">\(Q1, Q2... QN\)</span>
(shown above as <span class="math notranslate nohighlight">\(N=3\)</span>). The rate at which runoff moves through the
quick flow system is described by the residence time of the quick flow
tanks, <span class="math notranslate nohighlight">\(Kq\)</span> (day). Slow flow is routed through a parallel slow
flow tank and the rate at which slow flow is routed is described by the
slow flow residences time, <span class="math notranslate nohighlight">\(Ks\)</span> (day).</p>
<p>Citation: Wagener, T., Boyle, D. P., Lees, M. J., Wheater, H. S., Gupta,
H. V., &amp; Sorooshian, S. (2001). A framework for development and
application of hydrological models. Hydrology and Earth System Sciences,
5(1), 13-26.</p>
<p id="inputs">1.2 Input data</p>
<p>The HYMOD model only requires precipitation and potential
evapotranspiration as inputs. For this example, we’ll run HYMOD using
data from the Leaf River, a humid catchment located north of Collins
Mississippi that has been widely used to explore HYMOD. The dataset also
includes daily observed runoff that we later use to evaluate the
performance of each sensitivity analysis sample set.</p>
<p>In the following section of code, we’ll load the necessary python
libraries and read in the input file. For this exercise we’ll only use
the first eleven years of data. The first five rows of the input dataset
are printed to show what they look like:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msdbook</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msdbook.hymod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">msdbook.package_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_hymod_input_file</span><span class="p">,</span> <span class="n">load_hymod_params</span><span class="p">,</span> <span class="n">load_hymod_simulation</span><span class="p">,</span> <span class="n">load_hymod_monthly_simulations</span><span class="p">,</span> <span class="n">load_hymod_annual_simulations</span><span class="p">,</span> <span class="n">load_hymod_varying_simulations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">SALib.analyze</span><span class="w"> </span><span class="kn">import</span> <span class="n">sobol</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="c1"># load example data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">msdbook.install_supplement</span><span class="w"> </span><span class="kn">import</span> <span class="n">install_package_data</span>
<span class="n">install_package_data</span><span class="p">()</span>

<span class="c1"># load the Leaf River HYMOD input file</span>
<span class="n">leaf_data</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">load_hymod_input_file</span><span class="p">()</span>

<span class="c1"># extract the first eleven years of data</span>
<span class="n">leaf_data</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Leaf River Data structure:&#39;</span><span class="p">)</span>

<span class="c1"># There are only three columns in the file including precipitation, potential evapotranspiration and  streamflow</span>
<span class="n">leaf_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Downloading</span> <span class="n">example</span> <span class="n">data</span> <span class="k">for</span> <span class="n">msdbook</span> <span class="n">version</span> <span class="mf">0.1.5</span><span class="o">...</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">uncertain_params_bounds</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_metric_s1</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_vary_delta</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_by_mth_s1</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">solutions</span><span class="o">.</span><span class="n">resultfile</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">3704614</span><span class="n">_heatmap</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">LHsamples_original_1000</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">3704614</span><span class="n">_pseudo_r_scores</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">param_values</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_by_yr_s1</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_by_mth_delta</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">7000550</span><span class="n">_pseudo_r_scores</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">collapse_days</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hymod_params_256samples</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_vary_s1</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">7000550</span><span class="n">_heatmap</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">7200799</span><span class="n">_heatmap</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">sa_by_yr_delta</span><span class="o">.</span><span class="n">npy</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">7200799</span><span class="n">_pseudo_r_scores</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">LeafCatch</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hymod_simulations_256samples</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Unzipped</span><span class="p">:</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">notebook</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">msdbook</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">Robustness</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Leaf</span> <span class="n">River</span> <span class="n">Data</span> <span class="n">structure</span><span class="p">:</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Precip</th>
      <th>Pot_ET</th>
      <th>Strmflw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>4.60</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>4.31</td>
      <td>0.24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>4.33</td>
      <td>0.21</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>4.78</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>2.91</td>
      <td>0.18</td>
    </tr>
  </tbody>
</table>
</div><p>To visualize catchment hydrology, streamflow and precipitation data are
usually plotted together as a combined hydrograph (streamflow ) and
hyetograph (rainfall, from Greek hyetos, “rain”). Streamflow is plotted
as a time series, while rainfall is shown as an inverted bar plot along
the top of the graph. Streamflow labels are shown on the left y-axis,
while rainfall labels are shown on the right y-axis.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make an axis for the hydrograph</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">strmflw_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">strmflw_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>

<span class="c1">#make a second y-axis for the hyetograph</span>
<span class="n">precip_ax</span> <span class="o">=</span> <span class="n">strmflw_ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">precip_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
<span class="n">precip_ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

<span class="n">precip</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Precip&#39;</span><span class="p">]</span>
<span class="n">strmflw_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Precip&#39;</span><span class="p">])),</span> <span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Strmflw&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightcoral&#39;</span><span class="p">)</span>
<span class="n">strmflw_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Streamflow (mm/day)&#39;</span><span class="p">)</span>

<span class="n">precip_ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Precip&#39;</span><span class="p">])),</span> <span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Precip&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">precip_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rainfall (mm/day)&#39;</span><span class="p">)</span>
<span class="n">precip_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Precip&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
<span class="n">strmflw_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Streamflow&#39;</span><span class="p">],</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7f53b95c6850</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/hymod1.png" src="_images/hymod1.png" />
<p id="baseline">1.3 Running a Baseline Model Simulation</p>
<p>We’ll start our experiment by running HYMOD using its default
parameters.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign input parameters to generate a baseline simulated streamflow</span>
<span class="n">Nq</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Number of quickflow routing tanks</span>
<span class="n">Kq</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Quickflow routing tanks&#39; rate parameter</span>
<span class="n">Ks</span> <span class="o">=</span>  <span class="mf">0.001</span> <span class="c1"># Slowflow routing tank&#39;s rate parameter</span>
<span class="n">Alp</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Quick/slow split parameter</span>
<span class="n">Huz</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Maximum height of soil moisture accounting tank</span>
<span class="n">B</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># Scaled distribution function shape parameter</span>

<span class="c1"># Note that the number of years is 11. One year of model warm-up and ten years are used for actual simulation</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">hymod</span><span class="p">(</span><span class="n">Nq</span><span class="p">,</span> <span class="n">Kq</span><span class="p">,</span> <span class="n">Ks</span><span class="p">,</span> <span class="n">Alp</span><span class="p">,</span> <span class="n">Huz</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">leaf_data</span><span class="p">,</span> <span class="n">ndays</span><span class="o">=</span><span class="mi">4015</span><span class="p">)</span>
</pre></div>
</div>
<p id="outputs">1.4 Model Outputs</p>
<p>Model outputs include actual evapotranspiration, quick and fast
streamflow, and combined runoff. In this tutorial we focus on the total
daily runoff, QQ (<span class="math notranslate nohighlight">\(m^3/s\)</span>). We can use the following script to
plot simulated streamflow against observed streamflow.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>View the source code used to create this plot here: <a class="reference external" href="https://uc-ebook.org/docs/html/A3_plotting_code.html#plot-observed-vs-simulated-streamflow">plot_observed_vs_simulated_streamflow</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_observed_vs_simulated_streamflow</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">leaf_data</span><span class="p">,</span> <span class="n">hymod_dict</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod2.png" src="_images/hymod2.png" />
<p>So how does our model perform? We can investigate model performance
across several metrics:</p>
<p>1: Mean Absolute Error (MAE); MAE conveys how the model performs on
average across the 10 year simulation period, with smaller values
indicating better performance. The absolute value is taken so that
positive and negative errors do not cancel each other out.</p>
<div class="math notranslate nohighlight">
\[MAE = \frac{1}{N}\sum_{t=0}^N\left\lvert Q_{sim,t}-Q_{obs,t}\right\rvert\]</div>
<p>2: Root Mean Square Error (RMSE); RMSE is sum of square errors across
the 10 year simulation period. RMSE is sensitive to large errors between
the historical record and the simulated flows, and thus is useful for
highlighting the model’s ability to capture of extreme flood events.</p>
<div class="math notranslate nohighlight">
\[RMSE = \sqrt{\frac{1}{N}\sum_{t=1}^{N}(Q_{sim,t}-Q_{obs,t})^2}\]</div>
<p>3: Log-Root Mean Square Error (Log(RMSE)) LOG(RMSE) focuses on model
performance during low-flow events.</p>
<div class="math notranslate nohighlight">
\[LOG(RMSE) = log(RMSE)\]</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Strmflw&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]))</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">],</span> <span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;Strmflw&#39;</span><span class="p">])</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">mse</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">RMSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">LOG(RMSE): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MAE</span><span class="p">:</span> <span class="mf">1.0787471470460999</span>
<span class="n">RMSE</span><span class="p">:</span> <span class="mf">4.375695937555197</span>
<span class="n">LOG</span><span class="p">(</span><span class="n">RMSE</span><span class="p">):</span> <span class="mf">2.0918164206151544</span>
</pre></div>
</div>
<p>The error metrics show that HYMOD performs reasonably well, the MAE is
around 1 <span class="math notranslate nohighlight">\(m^3/s\)</span>, the RMSE is on the order of 10% of the largest
observed streamflow and the LOG(RMSE) is fairly low.</p>
</section>
<section id="id2">
<h2>2- Global Sensitivity Analysis<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p id="sensitivity">2.1 Experimental Design and Setup</p>
<p>Now we’ll examine how sensitive streamflow simulations generated by
HYMOD are to the model’s input parameters. We’ll perform global
sensitivity analysis (see Section 3.1 of the main text) using the SALib
Python library.</p>
<p>A first and critical step when conducting sensitivity analysis is
determining the experimental design (see Design of Experiments, Section
3.4 of the main text). Our experimental design involves defining the
uncertainties that we’ll be examining, the output of interest, the
ranges of each uncertainty that will be explored and the strategy for
sampling the uncertainty space.</p>
<p>For this experiment we’ll explore the five parameters highlighted in
Figure 1. We’ll draw their ranges from existing literature on the model
(note Jon H. paper). We’ll use a Sobol sampling an a quasi-random
sampling with low sequences approach to sample the uncertainty space
(Section 3.3.4).</p>
<p>In this demonstration we’ll utilize Sobol Sensitivity Analysis, a
variance based method (Section 3.4.5).</p>
<p>To explore HYMOD’s behavoir, we’ll examine the sensitivity of four model
ouputs to input parameters: 1) predicted flow, 2) Mean Absolute Error
(compared with the calibaration data set), 3) Root Mean Square Error and
1) Log Root Mean Square Error.</p>
<p>This analysis will employ SALib, a Python implementation also utilized
in the other SA tutorial (make this more formal).</p>
<p>To start our analysis, we’ll create a dictionary that describes our
model uncertainties and their ranges, this dictionary is named
“problem_hymod” (SALib refers to these dictionaries as “problems”).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">problem_hymod</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;num_vars&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span>
    <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># Kq</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># Ks</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>    <span class="c1"># Alp</span>
               <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>  <span class="c1"># Huz</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">]]</span>  <span class="c1"># B</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After defining our uncertainties and ranges, we’ll use SALib to sample
the uncertainty space and run the model for each of the sample sets. We
will load a sample that has already been created <code class="docutils literal notranslate"><span class="pre">param_values_hymod</span></code>
for demonstration purposes. For HYMOD, literature recommends running at
least N = 10,000 samples, to keep this demonstration easy to run
however, we utilize only 256 sobol samples of uncertainties. To generate
accurate approximations of second order sensitivity indices SALib
generates N*(2k+2) sets of samples, where N=256 and k=5 (number of
uncertainties). For the math behind why this is needed, see (Saltelli,
A., 2002. Making best use of model evaluations to compute sensitivity
indices. Computer Physics Communications 145, 280–297.
<a class="reference external" href="https://doi.org/10.1016/S0010-4655(02)00280-1">https://doi.org/10.1016/S0010-4655(02)00280-1</a>).</p>
<p>The actual model simulation takes an extended period, so we also load
the simulation data from a previous run. The following demonstrates how
to conduct this analysis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate 256 samples.</span>
<span class="n">param_values_hymod</span> <span class="o">=</span> <span class="n">saltelli</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>

<span class="c1"># dictionary to store outputs in</span>
<span class="n">d_outputs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># run simulation for each parameter sample</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_values_hymod</span><span class="p">)):</span>

    <span class="c1"># run model for each sensitivity analysis parameter sets</span>
    <span class="n">hymod_output</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="p">(</span><span class="n">Nq</span><span class="p">,</span>
                                 <span class="n">param_values_hymod</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                 <span class="n">param_values_hymod</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                 <span class="n">param_values_hymod</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                 <span class="n">param_values_hymod</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                 <span class="n">param_values_hymod</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                 <span class="n">leaf_data</span><span class="p">,</span>
                                 <span class="n">ndays</span><span class="o">=</span><span class="mi">4015</span><span class="p">)</span>

    <span class="c1"># store the simulated total flow discharge</span>
    <span class="n">d_outputs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hymod_output</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span>


<span class="n">Q_df_bw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d_outputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load previously generated parameter values</span>
<span class="n">param_values_hymod</span> <span class="o">=</span> <span class="n">load_hymod_params</span><span class="p">()</span>

<span class="c1"># number of samples</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_values_hymod</span><span class="p">)</span>

<span class="c1"># load previously generated hymod simulated outputs</span>
<span class="n">Q_df_bw</span> <span class="o">=</span> <span class="n">load_hymod_simulation</span><span class="p">()</span>

<span class="c1"># column names of each sample simulation number</span>
<span class="n">sample_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Q_df_bw</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</pre></div>
</div>
<section id="running-hymod-model-warm-up">
<h3>Running HYMOD - Model Warm-up<a class="headerlink" href="#running-hymod-model-warm-up" title="Link to this heading">#</a></h3>
<p>A hydrological model such as HYMOD usually includes ordinary
differential equations that are sensitive to their initial condition.
They also have components in their underlying formulation that have long
memory such that prior time steps can affect their current simulations.
For example, soil moisture or groundwater can hold water for a long time
and therefore they are often considered to exhibit a long memory. This
can affect the partitioning of water to runoff and infiltration, while
also controlling the generation of base flow. Therefore, it is important
to have a reasonable initial value for them. To achieve this,
hydrologists usually extend their simulation period and after the
simulations, they remove that extended time period that has unreasonable
groundwater or surface water values. This time period is called the
warm-up time period.</p>
<p>Here we extended our simulation for one year (from 10 years to 11 years)
and we removed the first year of simulation, therefore our warm-up
period is one year.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exclude the first year of simulation from the simulations and reset the index</span>
<span class="n">Q_df</span> <span class="o">=</span> <span class="n">Q_df_bw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">365</span><span class="p">:</span><span class="mi">4015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># exclude the first year of the input data and reset the index</span>
<span class="n">leaf_data</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">365</span><span class="p">:</span><span class="mi">4015</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that HYMOD has been warmed up, we’ll examine how HYMOD’s streamflow
outputs vary under different sample sets, and compare them with the
observed streamflow.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add date columns to our simulation data frame; for this data our start date is 1/1/2000</span>
<span class="n">date_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3650</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">Q_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span>
<span class="n">Q_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">year</span>
<span class="n">Q_df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">month</span>
<span class="n">Q_df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">day</span>

<span class="c1"># aggregate the simulated observed streamflow to monthly mean</span>
<span class="n">df_sim_mth_mean</span> <span class="o">=</span> <span class="n">Q_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># do the same for the observed data</span>
<span class="n">date_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">leaf_data</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span>
<span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">year</span>
<span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">month</span>
<span class="n">leaf_data</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_ts</span><span class="o">.</span><span class="n">day</span>

<span class="c1"># aggregate the daily observed streamflow to monthly mean</span>
<span class="n">df_obs_mth_mean</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>View the source code used to create this plot here: <a class="reference external" href="https://uc-ebook.org/docs/html/A3_plotting_code.html#plot-observed-vs-sensitivity-streamflow">plot_observed_vs_sensitivity_streamflow</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_observed_vs_sensitivity_streamflow</span><span class="p">(</span><span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_mth_mean</span><span class="p">,</span>
                                                           <span class="n">df_sim</span><span class="o">=</span><span class="n">df_sim_mth_mean</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod3.png" src="_images/hymod3.png" />
<p id="sametrics">2.2 Sensitivity of streamflows to model parameters</p>
<p>Now we’ll examine how each of HYMOD’s parameters impact the variance of
simulated streamflows. Using SALib we’ll calculate the first order and
total order sensitivity indices of each model parameter. The first
order sensitivity index measure’s the individual impact that a given
parameter has on the variance of the simulated streamflows. The total
order index measures the impact of a given parameter along with all
interactions that other parameters have with the given parameter on
simulated streamflows.</p>
<p>We’ll start with an matrix, Y, which contains our simulated streamflows
for every uncertainty sample. We’ll then use the sobol.analyze function
from SALib to calculate the sensitivity indices (Si). The arguments for
this function are the problem dictionary defined in part 2.2 of this
tutorial, and the matrix of simulated streamflows, Y.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># overall aggregated indices</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">Q_df</span><span class="p">[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># Perform analysis</span>
<span class="n">Si</span> <span class="o">=</span> <span class="n">sobol</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can examine our results, we’ll print the first order and total
order Si’s for each parameter, then visualize the results with bar plots</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First order indices = &#39;</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total order indices = &#39;</span><span class="p">,</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">])</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;First order Si&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total order Si&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">First</span> <span class="n">order</span> <span class="n">indices</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">9.55550001e-05</span> <span class="mf">7.49249463e-04</span> <span class="mf">5.62386413e-04</span> <span class="mf">7.03327551e-01</span>
 <span class="mf">2.53701895e-01</span><span class="p">]</span>
<span class="n">Total</span> <span class="n">order</span> <span class="n">indicies</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">1.76174200e-06</span> <span class="mf">1.63288175e-03</span> <span class="mf">3.41378460e-04</span> <span class="mf">6.88983864e-01</span>
 <span class="mf">2.53922146e-01</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod4.png" src="_images/hymod4.png" />
<p>Our findings indicate that in this instance, the streamflow estimate
from HYMOD is highly sensitive to soil moisture parameters Huz and B and
hardly affected by the routing parameters. Notably, there are very little
interactions between parameters causing the total order indices to be
nearly identical to the first order indices.</p>
<p id="diffperformance">2.3 How do different performance metrics affect the results of our
sensitivity analysis?</p>
<p>Streamflow has many different properties. In this section, we discuss
how the selection of metrics can lead to fundamentally different
sensitivity analysis results. For example, one can only focus on
aggregated streamflow metrics such as mean (what has been presented so
far), or only on extreme events such as drought or floods.</p>
<p>Here we compare three different metrics: 1- Mean error (ME) 2- Root Mean
Square Error (RMSE) 3- Log-Root Mean Square Error (Log(RMSE))</p>
<p>Each of these metrics focuses on a specific attribute of streamflow. For
example, RMSE highlights the impacts of extreme flood events, while
LOG(RMSE) focuses on model performance during low-flow events.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate error metrics</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">Q_df</span><span class="p">[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">leaf_data</span><span class="p">[</span><span class="s2">&quot;Strmflw&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">Q_df</span><span class="p">[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">leaf_data</span><span class="p">[</span><span class="s2">&quot;Strmflw&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">mse</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># add error metrics to a dictionary</span>
<span class="n">d_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mae</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
             <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
             <span class="s1">&#39;LOG[RMSE]&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmse</span><span class="o">.</span><span class="n">values</span><span class="p">)}</span>

<span class="c1"># convert to a dataframe</span>
<span class="n">df_metrics_SA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d_metrics</span><span class="p">)</span>
</pre></div>
</div>
<p>We can use the following to calculate the SA indices for each metric and
visualize it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_metric_s1_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">df_metric_sT_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>

<span class="c1"># conduct sensitivity analysis for each metric</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

    <span class="c1"># get the data as a numpy array for the target metric</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">d_metrics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># use the metric to conduct SA</span>
    <span class="n">Si</span> <span class="o">=</span> <span class="n">sobol</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">print_to_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># add the sensitivity indices to the output data frame</span>
    <span class="n">df_metric_s1_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">]</span>
    <span class="n">df_metric_sT_result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create seaborn heatmap with required labels</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="c1"># labels for y-axis</span>
<span class="n">y_axis_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mean Absolute Error&#39;</span><span class="p">,</span> <span class="s1">&#39;RSME&#39;</span><span class="p">,</span> <span class="s1">&#39;Log(RMSE)&#39;</span><span class="p">]</span>

<span class="c1"># plot heatmap</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_metric_s1_result</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">y_axis_labels</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno_r&#39;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Si&#39;</span><span class="p">},</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First Order Sensitivity&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_metric_sT_result</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">y_axis_labels</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno_r&#39;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Si&#39;</span><span class="p">})</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Order Sensitivity&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Total Order Sensitivity&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod5.png" src="_images/hymod5.png" />
<p>The first order sensitivity indices indicate that HYMOD’s sensitivity
to its parameters is different depending on how its output is measured.
Unsurprisingly, the mean absolute error is highly sensitive to the soil
moisture accounting parameters Huz and B, just like the overall
streamflow predictions above. However, when we examine RMSE and
log(RMSE), the routing parameters Alp become sensitive, and the
sensitivity to parameter B is reduced. As described above, RMSE and
LOG(RMSE) respond to model performance in high-flow and low flow periods
respectively. Our results indicate that for these flow regimes Alp, the
parameter that governs the split between quick and slow flow is an
important factor. While still the parameter with the highest most effect
on all three measures, Huz is much less influential for RMSE and
LOG(RMSE) than it is for MAE.</p>
<p>The total order sensitivity indices review a different, more complex
story. While the MAE sensitivity is relatively governed by first order
effects (like the streamflow predictions above), the RMSE and LOG(RMSE)
error metrics show significant interactions. Alp has the highest total
order sensitivity for RMSE and is equal to Huz for Log(RMSE). Kq, which
has a relatively low first order sensitivity index, shows strong
contribution to variance when interactions are taken into account.</p>
<p>Radial convergence plots are a helpful way to visualize the interactions
between parameters. These plots array the model parameters in a circle
and plot the first order, total order and second order Sobol sensitivity
indices for each parameter. The first order sensitivity is shown as the
size of a closed circle, the total order as the size of a larger open
circle and the second order as the thickness of a line connecting two
parameters. Below is an example of a radial convergence plot for the
LOG(RMSE) measure. The plot indicates strong interactions between the
Huz and Alp parameters, as well as Alp and Kq. There is also an
interaction between Alp and Ks.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;axes_linewidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;axes.edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">})</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_significant</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">confidence_interval</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;conf&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="o">==</span> <span class="s2">&quot;conf&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">confidence_interval</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">threshold</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>


<span class="k">def</span><span class="w"> </span><span class="nf">grouped_radial</span><span class="p">(</span><span class="n">SAresults</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">radSc</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">widthSc</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">STthick</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">varNameMult</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpNameMult</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;conf&quot;</span><span class="p">):</span>
    <span class="c1"># Derived from https://github.com/calvinwhealton/SensitivityAnalysisPlots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># initialize parameters and colors</span>
    <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            <span class="n">color_map</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;deep&quot;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="n">color_map</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">radSc</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">radSc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">radSc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

    <span class="c1"># plot second-order indices</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_significant</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S2&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S2_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">threshold</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">((</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">angle</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">line_hw</span> <span class="o">=</span> <span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S2&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="n">widthSc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_hw</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.75&quot;</span><span class="p">))</span>

    <span class="c1"># plot total order indices</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_significant</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;ST_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">threshold</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="n">widthSc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;ST&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="n">widthSc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">STthick</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1"># plot first-order indices</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_significant</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S1_conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">threshold</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">SAresults</span><span class="p">[</span><span class="s2">&quot;S1&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="n">widthSc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">))</span>

    <span class="c1"># add labels</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">varNameMult</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">varNameMult</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">key</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color_map</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">group_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">angles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">gpNameMult</span><span class="o">*</span><span class="n">radSc</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">group_angle</span><span class="p">),</span> <span class="n">gpNameMult</span><span class="o">*</span><span class="n">radSc</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">group_angle</span><span class="p">),</span> <span class="n">group</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">group_angle</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">radSc</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radSc</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">radSc</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">radSc</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># define groups for parameter uncertainties</span>
<span class="n">groups</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Soil Moisture&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Huz&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Routing&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Alp&quot;</span><span class="p">,</span> <span class="s2">&quot;Kq&quot;</span><span class="p">,</span> <span class="s2">&quot;Ks&quot;</span><span class="p">]}</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">grouped_radial</span><span class="p">(</span><span class="n">Si</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.025</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Soil</span> <span class="n">Moisture</span>
<span class="n">Routing</span>
</pre></div>
</div>
<img alt="_images/hymod6.png" src="_images/hymod6.png" />
<p>2.4 Time-Varying Sensitivity Analysis</p>
<p id="time">In section 2.5 we saw how performing sensitivity analysis on different
measurements of model output can yield in different results on the
importance of each uncertain input. In this section we’ll examine how
performing this analysis over time can yield additional insight into the
performance of HYMOD. We’ll first examine how model sensitivities vary
by month, then examine how they change across each year of the
simulation.</p>
<p>For this demonstration, we’ll focus only on the monthly streamflow
predictions generated by HYMOD.</p>
<section id="sensitivity-analysis-indices-for-each-month">
<h4>2.4.1 Sensitivity analysis indices for each month<a class="headerlink" href="#sensitivity-analysis-indices-for-each-month" title="Link to this heading">#</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aggregate simulated streamflow data to monthly time series</span>
<span class="n">df_sim_by_mth_mean</span> <span class="o">=</span> <span class="n">Q_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># aggregate observed streamflow data to monthly time series</span>
<span class="n">df_obs_by_mth_mean</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>We can use the following to calculate the SA indices for each month and
visualize it. Results are pre-loaded for efficiency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up dataframes to store outputs</span>
<span class="n">df_mth_s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">df_mth_delta</span> <span class="o">=</span> <span class="n">df_mth_s1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># iterate through each month</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span>

    <span class="c1"># generate the simulation data</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">df_sim_by_mth_mean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># run SA</span>
    <span class="n">Si</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="n">param_values_hymod</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">print_to_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># add to output dataframes</span>
    <span class="n">df_mth_s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df_mth_delta</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># convert to arrays</span>
<span class="n">arr_mth_s1</span> <span class="o">=</span> <span class="n">df_mth_s1</span><span class="o">.</span><span class="n">values</span>
<span class="n">arr_mth_delta</span> <span class="o">=</span> <span class="n">df_mth_delta</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</section>
</section>
<section id="first-order-indices">
<h3>First-order Indices<a class="headerlink" href="#first-order-indices" title="Link to this heading">#</a></h3>
<p>The following can be used to visualize the time-varying first-order
indices. The first order represents the direct impacts of a specific
parameter on model outputs.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>View the source code used to create this plot here: <a class="reference external" href="https://uc-ebook.org/docs/html/A3_plotting_code.html#plot-monthly-heatmap">plot_monthly_heatmap</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load previously ran data</span>
<span class="n">arr_mth_delta</span><span class="p">,</span> <span class="n">arr_mth_s1</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">load_hymod_monthly_simulations</span><span class="p">()</span>

<span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_monthly_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_mth_s1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                             <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_by_mth_mean</span><span class="p">,</span>
                                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;First Order - Mean Monthly SA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod7.png" src="_images/hymod7.png" />
<p>This figure demonstrates the first order sensitivity indices when the
streamflow data are aggregated by month. The purple line represents the
observed monthly discharge. The figure indicates that the first order
indices are highest for B and Huz across all months and lowest for Alp,
Ks, and Kq. Note that in the months with the highest flow, Ks becomes an
influential parameter.</p>
</section>
<section id="total-order-indices">
<h3>Total-order indices<a class="headerlink" href="#total-order-indices" title="Link to this heading">#</a></h3>
<p>We can also focus on the total order sensitivity index that includes
first-order SA indices and interactions between parameters</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_monthly_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_mth_delta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                       <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_by_mth_mean</span><span class="p">,</span>
                                       <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total Order - Mean monthly SA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod8.png" src="_images/hymod8.png" />
<p>Notably, the total order sensitivity results are different than the
first order sensitivity results, which indicates that interactions
between the parameters (particularly in regards to routing parameters
<span class="math notranslate nohighlight">\(Kq\)</span>, <span class="math notranslate nohighlight">\(Ks\)</span>, and <span class="math notranslate nohighlight">\(Alp\)</span>) contribute to changes in HYMOD
output.</p>
<section id="annual-sensitivity-analysis-indices">
<h4>2.4.2 Annual sensitivity analysis indices<a class="headerlink" href="#annual-sensitivity-analysis-indices" title="Link to this heading">#</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group by year and get mean</span>
<span class="n">df_sim_by_yr_mean</span> <span class="o">=</span> <span class="n">Q_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="n">sample_column_names</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># group input data and get mean</span>
<span class="n">df_obs_by_yr_mean</span> <span class="o">=</span> <span class="n">leaf_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>We can also calculate the sensitivity analysis indices for each
individual year. This will allow us to understand if model control
changes during different years. The following code first aggregates the
outputs to annual time steps, and then calculates the SA indices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up dataframes to store outputs</span>
<span class="n">df_yr_s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
<span class="n">df_yr_delta</span> <span class="o">=</span> <span class="n">df_yr_s1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># iterate through each year</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>

    <span class="c1"># generate the simulation data</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">df_sim_by_yr_mean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># run SA</span>
    <span class="n">Si</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="n">param_values_hymod</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">print_to_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># add to output dataframes</span>
    <span class="n">df_yr_s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df_yr_delta</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># convert to arrays</span>
<span class="n">arr_yr_s1</span> <span class="o">=</span> <span class="n">df_mth_s1</span><span class="o">.</span><span class="n">values</span>
<span class="n">arr_yr_delta</span> <span class="o">=</span> <span class="n">df_mth_delta</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</section>
</section>
<section id="id3">
<h3>First-order indices<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>View the source code used to create this plot here: <a class="reference external" href="https://uc-ebook.org/docs/html/A3_plotting_code.html#plot-annual-heatmap">plot_annual_heatmap</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load previously ran data</span>
<span class="n">arr_yr_delta</span><span class="p">,</span> <span class="n">arr_yr_s1</span> <span class="o">=</span> <span class="n">load_hymod_annual_simulations</span><span class="p">()</span>

<span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_annual_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_yr_s1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                            <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_by_yr_mean</span><span class="p">,</span>
                                            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;First Order - Mean Annual SA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod9.png" src="_images/hymod9.png" />
<p>The first order sensitivities at the annual scale are not unlike the
first order monthly sensitivities. Once again, sensitivities vary across
year and Huz and B are the most consequential parameters.</p>
</section>
<section id="id4">
<h3>Total-order indices<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_annual_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_yr_delta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                            <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_by_yr_mean</span><span class="p">,</span>
                                            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total Order - Mean Annual SA and Observed flow&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod10.png" src="_images/hymod10.png" />
<p>Our results indicate that sensitivity analysis indices vary in different
years and now that interactions are included, the Kq, Ks, and Alp
variables impact the sensitivity of the streamflow output.</p>
<section id="monthly-time-varying-sensitivity-analysis">
<h4>2.4.3 Monthly time-varying sensitivity analysis<a class="headerlink" href="#monthly-time-varying-sensitivity-analysis" title="Link to this heading">#</a></h4>
<p>Although time-varying sensitivity analysis (TVSA) at average monthly and
average annual temporal resolutions is informative, TVSA is susceptible
to the aggregation issue that we discussed earlier in section 3-2. To
avoid that we can further discretize our time domain to zoom into
individual months. This will provide us with even more information about
model behavior and the sensitivity of different parameters in different
states of the system. The block of code demonstrates how to implement
the monthly TVSA.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up dataframes to store outputs</span>
<span class="n">df_vary_s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">df_obs_mth_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">)),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Kq&#39;</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">,</span> <span class="s1">&#39;Alp&#39;</span><span class="p">,</span> <span class="s1">&#39;Huz&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>

<span class="n">df_vary_delta</span> <span class="o">=</span> <span class="n">df_vary_s1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># iterate through each month</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_obs_mth_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

    <span class="c1"># generate the simulation data</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">df_sim_mth_mean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># run SA</span>
    <span class="n">Si</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">problem_hymod</span><span class="p">,</span> <span class="n">param_values_hymod</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">print_to_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># add to output dataframes</span>
    <span class="n">df_vary_s1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df_vary_delta</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">Si</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># convert to arrays</span>
<span class="n">arr_vary_s1</span> <span class="o">=</span> <span class="n">df_vary_s1</span><span class="o">.</span><span class="n">values</span>
<span class="n">arr_vary_delta</span> <span class="o">=</span> <span class="n">df_vary_delta</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</section>
</section>
<section id="id5">
<h3>First-order indices<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>View the source code used to create this plot here: <a class="reference external" href="https://uc-ebook.org/docs/html/A3_plotting_code.html#plot-varying-heatmap">plot_varying_heatmap</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load in previously ran data</span>
<span class="n">arr_vary_delta</span><span class="p">,</span> <span class="n">arr_vary_s1</span> <span class="o">=</span> <span class="n">load_hymod_varying_simulations</span><span class="p">()</span>

<span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_varying_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_vary_s1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                             <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_mth_mean</span><span class="p">,</span>
                                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;First Order - Time-Varying SA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod11.png" src="_images/hymod11.png" />
<p>Compared to the TVSA when streamflow was aggregated, this figure
suggests that Kq is indeed a relevant parameter for influencing
streamflow output when individual months are considered.</p>
</section>
<section id="total-order-time-varying-sensitivity-analysis">
<h3>Total order - time varying sensitivity analysis<a class="headerlink" href="#total-order-time-varying-sensitivity-analysis" title="Link to this heading">#</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot figure</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">msdbook</span><span class="o">.</span><span class="n">hymod</span><span class="o">.</span><span class="n">plot_varying_heatmap</span><span class="p">(</span><span class="n">arr_sim</span><span class="o">=</span><span class="n">arr_vary_delta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                             <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs_mth_mean</span><span class="p">,</span>
                                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total Order - Time-Varying SA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/hymod12.png" src="_images/hymod12.png" />
<p>As above, the total order sensitivities further indicate the importance
of Kq that is not apparent if aggregation is utilized.</p>
</section>
</section>
<section id="tips-to-apply-this-methodology-to-your-own-problem">
<h2>Tips to Apply this methodology to your own problem<a class="headerlink" href="#tips-to-apply-this-methodology-to-your-own-problem" title="Link to this heading">#</a></h2>
<p>In this tutorial, we demonstrated how to use global sensitivtiy analysis
to explore a complex, non-linear model. We showed how measuring
sensitivity across multiple measures of model performance and temporal
aggregations yielding differing results about model
sensitivity/behavoir. While these results may seem contraditory, they
provide useful insight into the behavoir of HYMOD. Would we expect the
same parameters to control high flow and low flow regimes within the
model? Maybe, depending on the system, but also, maybe not. This
analysis can provide insight into how the model responds to its input
parameters, allowing us to compare the results to our expectaions. This
may allow us to find problems with our intial assumptions, or call
attention to model features that can be improved or expanded upon.
Depending on the model and context, it may also yield insight into the
workings of the underlying system.</p>
<p>To run this tutorial on your own model you will need to:</p>
<ol class="arabic simple">
<li><p>Design your experiment by choosing sampling bounds for your
parameters and setting up the problem dictionary as in step 2-2</p></li>
<li><p>Choose the parameters of interest</p></li>
<li><p>Generate samples using the saltelli.sample function. This step is
problem-dependent and note that the Sobol method can be
computationally intensive depending on the model being analyzed. More
complex models will be slower to run and will also require more
samples to calculate accurate estimates of Sobol indices. Once you
complete this process, pay attention to the confidence bounds on your
sensitivity indices to see whether you need to run more samples.</p></li>
<li><p>Run the parameter sets through your model and record each of the
desired model outputs.</p></li>
<li><p>Calculate the Sobol indices for each performance criteria. Now, the Y
will be a numpy array with your external model output and you will
need to include the parameter samples as an additional argument.</p></li>
<li><p>Follow the procedure in step 2.6 to disaggregate performance across
time</p></li>
</ol>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorial-sensitivity-analysis-of-the-hymod-model">Tutorial: Sensitivity Analysis of the HYMOD Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-hymod">1. Introduction to HYMOD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-sensitivity-analysis">2. Global Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1 - Introduction to HYMOD</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2- Global Sensitivity Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-hymod-model-warm-up">Running HYMOD - Model Warm-up</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis-indices-for-each-month">2.4.1 Sensitivity analysis indices for each month</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-indices">First-order Indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-order-indices">Total-order indices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#annual-sensitivity-analysis-indices">2.4.2 Annual sensitivity analysis indices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">First-order indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Total-order indices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#monthly-time-varying-sensitivity-analysis">2.4.3 Monthly time-varying sensitivity analysis</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">First-order indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-order-time-varying-sensitivity-analysis">Total order - time varying sensitivity analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tips-to-apply-this-methodology-to-your-own-problem">Tips to Apply this methodology to your own problem</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-current, Battelle Memorial Institute.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>